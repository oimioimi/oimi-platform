<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>منصة OIMI - طلب تقييم</title>

<style>
:root { --p:#00732f; --lg:#e8f5e9; }
body { margin:0; font-family:'Segoe UI',sans-serif; background:#fff; }
.container { max-width:600px; margin:auto; padding:10px; }
.card { background:#fff; padding:20px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,.1); }
label { font-weight:bold; font-size:13px; display:block; margin-top:8px; }
input, select, textarea {
  width:100%; padding:10px; border-radius:8px;
  border:1px solid #ccc; font-size:14px;
}
.num-input { direction:ltr; text-align:left; }
.btn {
  width:100%; background:linear-gradient(135deg,#00732f,#00a342);
  color:#fff; padding:14px; border:none; border-radius:10px;
  font-size:16px; font-weight:bold; margin-top:15px; cursor:pointer;
}
.box {
  background:var(--lg); padding:12px; border-radius:10px;
  border:1px solid var(--p); margin-bottom:10px; font-size:13px;
}
</style>
</head>

<body>
<div class="container">
<div class="card">

<h2 style="text-align:center">طلب التقييم المهني</h2>

<form id="oimi-form" enctype="multipart/form-data">
<div class="box">
<strong>خطوات إتمام الطلب:</strong><br>
1️⃣ تحويل الرسوم<br>
2️⃣ تعبئة البيانات<br>
3️⃣ إرسال الطلب
</div>

<label>الاسم بالعربية *</label>
<input id="u_name_ar" required>

<label>الاسم بالإنجليزية *</label>
<input id="u_name_en" class="num-input" required>

<label>التخصص *</label>
<input id="u_spec" required>

<label>بلد الإقامة *</label>
<select id="u_country" required onchange="handleCountryChange(this)">
<option value="">اختر الدولة</option>
</select>

<label>رقم الهاتف *</label>
<input id="u_phone" class="num-input" disabled required>

<label>رقم الواتساب *</label>
<input id="u_whatsapp" class="num-input" disabled required>

<label>البريد الإلكتروني *</label>
<input type="email" id="u_email" required>

<label>ملاحظات</label>
<textarea id="u_notes"></textarea>

<label>كيف سمعت عنا *</label>
<select id="u_source" required>
<option value="">اختر</option>
<option>فيسبوك</option>
<option>لينكد إن</option>
<option>تيك توك</option>
<option>صديق</option>
</select>

<label>السيرة الذاتية *</label>
<input type="file" id="cv_file" accept=".pdf,image/*" required>

<label>إيصال التحويل *</label>
<input type="file" id="receipt_file" accept="image/*" required>

<button class="btn" id="submitBtn">إرسال الطلب</button>

</form>
</div>
</div>

<script>
// ================== إعداد الدول ==================
const countryCodes = {
 "السودان":"00249","مصر":"0020","السعودية":"00966",
 "الإمارات":"00971","قطر":"00974","الكويت":"00965"
};
const cSel = document.getElementById("u_country");
Object.keys(countryCodes).forEach(c=>{
  const o=document.createElement("option"); o.value=c; o.textContent=c; cSel.appendChild(o);
});
function handleCountryChange(el){
 const p=document.getElementById("u_phone");
 const w=document.getElementById("u_whatsapp");
 p.disabled=w.disabled=false;
 p.value=w.value=countryCodes[el.value];
}

// ================== الإرسال ==================
const scriptURL = "https://script.google.com/macros/s/AKfycbxHNetzb3P5sa7cDfADC-WlqsDu_NngTIycpbCsvF1B5ACMH4QogJb6svDIVQ9-8aao/exec";

document.getElementById("oimi-form").addEventListener("submit", async e=>{
 e.preventDefault();
 const btn=document.getElementById("submitBtn");
 btn.disabled=true; btn.textContent="جاري الإرسال...";

 const fd=new FormData();
 fd.append("الاسم العربي", u_name_ar.value);
 fd.append("الاسم الانجليزي", u_name_en.value);
 fd.append("التخصص", u_spec.value);
 fd.append("بلد الإقامة", u_country.value);
 fd.append("رقم الهاتف", u_phone.value);
 fd.append("رقم الواتساب", u_whatsapp.value);
 fd.append("البريد", u_email.value);
 fd.append("ملاحظات", u_notes.value);
 fd.append("المصدر", u_source.value);
 fd.append("cv_file", cv_file.files[0]);
 fd.append("receipt_file", receipt_file.files[0]);

 try {
   await fetch(scriptURL, { method: "POST", body: fd, mode: "no-cors" });
   alert("تم إرسال طلبك بنجاح ✅");
   const waText = encodeURIComponent("تم إرسال طلبي باسم: "+u_name_ar.value);
   window.open(`https://wa.me/249900065080?text=${waText}`, "_blank");
   location.reload();
 } catch (err) {
   alert("حدث خطأ ❌ يرجى المحاولة لاحقًا");
   btn.disabled=false; btn.textContent="إرسال الطلب";
 }
});
</script>

</body>
</html>
