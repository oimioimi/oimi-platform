<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>منصة OIMI - طلب تقييم</title>
<link rel="icon" type="image/png" href="https://i.postimg.cc/cJRw69tq/Favicon-for-OIMI.png">
<style>
:root { --p: #00732f; --lg: #e8f5e9; }
body { background: #fff; margin: 0; font-family: 'Segoe UI', sans-serif; padding: 5px; text-align: right; overflow-x: hidden; }
.container { max-width: 600px; margin: auto; display: flex; flex-direction: column; gap: 2px; }
.card { background: #fff; padding: 18px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #eee; }
.oimi-style { display: inline-flex; align-items: baseline; direction: ltr; font-weight: bold; color: #000; }
.oimi-i { display: inline-block; line-height: 1; background: linear-gradient(to bottom, #ff0000 20%, #000000 20%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.main-title { text-align: center; margin-bottom: 8px; font-weight: 800; font-size: 22px; }
.main-title .oimi-style { font-size: 34px; } 
.box { background: var(--lg); padding: 12px; border-radius: 10px; border: 1px solid var(--p); margin-bottom: 10px; color: #2e7d32; font-size: 13px; line-height: 1.6; }
label { display: block; margin: 4px 0 2px; font-weight: bold; font-size: 13px; color: #444; }
input, select, textarea { width: 100%; padding: 10px; margin-bottom: 5px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-size: 14px; background: #f9f9f9; font-weight: bold; }
.num-input { direction: ltr; text-align: left; }
.btn { width: 100%; background: linear-gradient(135deg, #00732f, #00a342); color: white; padding: 14px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; }
.slider { width: 100%; overflow: hidden; margin-top: 15px; text-align: center; direction: ltr; position: relative; height: 260px; }
.track { display: flex; width: max-content; animation: scroll-loop 25s linear infinite; padding: 20px 0; align-items: center; }
.track img { width: 260px; height: 160px; object-fit: cover; margin: 0 15px; border-radius: 12px; }
@keyframes scroll-loop { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
</style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2 class="main-title">منصة <span class="oimi-style">O<span class="oimi-i">i</span>M<span class="oimi-i">i</span>.ae</span><br><span style="font-size:14px; color:#444; font-weight:normal;">طلب التقييم المهني وعمل السير الذاتية (ATS)</span></h2>
        
        <form id="oimi-form">
            <div class="box">
                <strong>✅ خطوات إتمام الطلب:</strong><br>
                ١. تحويل الرسوم (50,000 جنيه) لبنك الخرطوم: 4623370 باسم عمر إبراهيم.<br>
                ٢. أكمل البيانات واضغط "إرسال" للحفظ.
            </div>

            <label>الاسم الرباعي (بالعربية) *</label>
            <input type="text" id="u_name_ar" required oninput="this.value=this.value.replace(/[a-zA-Z]/g,'')">
            
            <label>الاسم الرباعي (بالإنجليزية) *</label>
            <input type="text" id="u_name_en" class="num-input" required oninput="this.value=this.value.replace(/[\u0600-\u06FF]/g,'')">

            <label>التخصص المهني *</label>
            <input type="text" id="u_spec" required>
            
            <label>بلد الاقامة *</label>
            <select id="u_country" required onchange="handleCountryChange(this)">
                <option value="">اختر الدولة...</option>
                <option value="السودان">السودان</option>
                <option value="الإمارات">الإمارات</option>
                <option value="السعودية">السعودية</option>
                <option value="مصر">مصر</option>
                <option value="قطر">قطر</option>
                <option value="عمان">عمان</option>
            </select>
            
            <label>رقم الهاتف *</label>
            <input type="tel" id="u_phone" class="num-input" disabled required oninput="this.value=this.value.replace(/[^0-9]/g,'')">

            <label>رقم الواتساب *</label>
            <input type="tel" id="u_whatsapp" class="num-input" disabled required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
            
            <label>البريد الالكتروني *</label>
            <input type="email" id="u_email" required>

            <label>كيف سمعت عنا؟ *</label>
            <select id="u_source" required>
                <option value="">اختر المصدر...</option>
                <option value="فيسبوك">فيسبوك</option>
                <option value="لينكد إن">لينكد إن</option>
                <option value="صديق">صديق</option>
            </select>

            <label>ملاحظات (اختياري)</label>
            <textarea id="u_notes" rows="2"></textarea>

            <label>أرفق السيرة الذاتية (PDF/صورة) *</label>
            <input type="file" id="cv_file" accept=".pdf,image/*" required>
            
            <label>أرفق إيصال التحويل *</label>
            <input type="file" id="receipt_file" accept="image/*" required>

            <button type="submit" class="btn" id="submitBtn">إرسال الطلب وحفظ البيانات</button>
        </form>
    </div>

    <div class="slider">
        <div class="track">
            <img src="https://i.postimg.cc/vHPSwW3p/528604980-10162083330481298-381945114741787991-n.jpg">
            <img src="https://i.postimg.cc/sDn0Cpwb/585747945-10162491435001298-5020852638269490297-n.jpg">
            <img src="https://i.postimg.cc/Wb9fcMXY/QVZo-ZFNzc-Wdi-MUx2a-HJMUFRhe-GJza-TZI.jpg">
        </div>
    </div>
</div>

<script>
// الرابط الجديد إصدار 92
const scriptURL = "https://script.google.com/macros/s/AKfycbxf7r7S_xEg848r0DeokWfNqBd-UhTTEF0XV3JFg40CoIhb2JLPs3eZBJ_ceQSS11Kc/exec";

const countryCodes = { "السودان": "00249","الإمارات": "00971","السعودية": "00966","مصر": "0020","قطر":"00974","عمان":"00968" };
function handleCountryChange(el){ 
    const p=document.getElementById('u_phone'), w=document.getElementById('u_whatsapp'); 
    if(el.value){ p.disabled=false; w.disabled=false; p.value=countryCodes[el.value]; w.value=countryCodes[el.value]; } 
}

const form=document.getElementById('oimi-form');
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const btn=document.getElementById('submitBtn');
  btn.disabled=true; btn.innerHTML="جاري الحفظ وإرسال الطلب...";

  try {
    const toBase64=f=>new Promise((res)=>{ const r=new FileReader(); r.onload=()=>res(r.result.split(',')[1]); r.readAsDataURL(f); });
    
    const payload={ 
      "الاسم العربي": document.getElementById('u_name_ar').value, 
      "الاسم الانجليزي": document.getElementById('u_name_en').value, 
      "التخصص المهني": document.getElementById('u_spec').value, 
      "بلد الإقامة": document.getElementById('u_country').value, 
      "رقم الهاتف": document.getElementById('u_phone').value, 
      "رقم الواتس": document.getElementById('u_whatsapp').value, 
      "البريد الإلكتروني": document.getElementById('u_email').value, 
      "كيف سمعت عننا": document.getElementById('u_source').value,
      "ملاحظات": document.getElementById('u_notes').value, 
      "cv_data": await toBase64(document.getElementById('cv_file').files[0]), 
      "receipt_data": await toBase64(document.getElementById('receipt_file').files[0]) 
    };

    // إرسال البيانات باستخدام fetch مع انتظار الرد
    const response = await fetch(scriptURL, { 
        method: 'POST', 
        body: JSON.stringify(payload)
    });
    
    const result = await response.json();

    if (result.status === "success") {
        alert("تم استلام طلبك بنجاح ✅\nرقم تسجيلك هو: " + result.uniqueId); 
        window.open(`https://wa.me/249900065080?text=تم التسجيل بنجاح في منصة OIMI. رقم تسجيل الطلب الخاص بي هو: ${result.uniqueId}`,'_blank'); 
        location.reload();
    } else {
        throw new Error(result.message);
    }

  } catch(err){ 
    alert("حدث خطأ أثناء الحفظ، ولكن قد تكون البيانات قد وصلت. يرجى مراجعة واتساب المنصة للتأكد.");
