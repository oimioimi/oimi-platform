<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>منصة OIMI - طلب تقييم</title>
<link rel="icon" type="image/png" href="https://i.postimg.cc/cJRw69tq/Favicon-for-OIMI.png">

<style>
:root { --p: #00732f; --lg: #e8f5e9; }
body { background: #fff; margin: 0; font-family: 'Segoe UI', sans-serif; padding: 5px; text-align: right; overflow-x: hidden; }
.container { max-width: 600px; margin: auto; display: flex; flex-direction: column; gap: 2px; }
.card { background: #fff; padding: 18px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #eee; }

.oimi-style { display: inline-flex; align-items: baseline; direction: ltr; font-weight: bold; color: #000; }
.oimi-i { display: inline-block; line-height: 1; background: linear-gradient(to bottom, #ff0000 20%, #000000 20%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

.main-title { text-align: center; margin-bottom: 8px; font-weight: 800; font-size: 22px; }
.main-title .oimi-style { font-size: 34px; } 

.box { background: var(--lg); padding: 12px; border-radius: 10px; border: 1px solid var(--p); margin-bottom: 10px; color: #2e7d32; font-size: 13px; line-height: 1.6; }
.help-link-center { text-align: center; margin-top: 8px; padding-top: 8px; border-top: 1px dashed var(--p); }

label { display: block; margin: 4px 0 2px; font-weight: bold; font-size: 13px; color: #444; }
input, select, textarea { width: 100%; padding: 10px; margin-bottom: 5px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-size: 14px; background: #f9f9f9; font-weight: bold; }
.num-input { direction: ltr; text-align: left; }
.separator { border-top: 1px dashed var(--p); margin: 8px 0; opacity: 0.5; }

.footer-section { background: #fff; border-top: 1px solid #eee; margin-top: 15px; padding: 15px; text-align: center; }

.btn { width: 100%; background: linear-gradient(135deg, #00732f, #00a342); color: white; padding: 14px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; }
</style>
</head>
<body>

<div class="container">
<div class="card">
<form id="oimi-form">

<input type="text" id="website" style="display:none">

<label>الاسم الرباعي (بالعربية فقط) *</label>
<input type="text" id="u_name_ar" required oninput="this.value=this.value.replace(/[a-zA-Z]/g,'')">

<label>الاسم الرباعي (بالإنجليزية فقط) *</label>
<input type="text" id="u_name_en" class="num-input" required oninput="this.value=this.value.replace(/[\u0600-\u06FF]/g,'')">

<label>التخصص المهني *</label>
<input type="text" id="u_spec" required>

<label>بلد الاقامة *</label>
<select id="u_country" required onchange="handleCountryChange(this)"></select>

<label>رقم الهاتف *</label>
<input type="tel" id="u_phone" class="num-input" disabled required>

<label>رقم الواتساب *</label>
<input type="tel" id="u_whatsapp" class="num-input" disabled required>

<label>البريد الالكتروني *</label>
<input type="email" id="u_email" required>

<label>ملاحظات إضافية</label>
<textarea id="u_notes" rows="2"></textarea>

<label>كيف سمعت عنا؟ *</label>
<select id="u_source" required>
<option value="">اختر...</option>
<option>فيسبوك</option>
<option>لينكد إن</option>
<option>تيك توك</option>
<option>صديق</option>
</select>

<label>السيرة الذاتية *</label>
<input type="file" id="cv_file" accept=".pdf,image/*" required>

<label>إيصال التحويل *</label>
<input type="file" id="receipt_file" accept="image/*" required>

<button type="submit" class="btn" id="submitBtn">إرسال الطلب وحفظ البيانات</button>
</form>
</div>
</div>

<script>
const scriptURL="https://script.google.com/macros/s/AKfycbwL-jQa-sF4nEFVWtPlmAi3y8jgWX2erSHfbpFD_RP4d4bAQ1KWI-x6XgPuk5dca5WB/exec";
const loadTime=Date.now();
const btn=document.getElementById('submitBtn');

function clean(v){return v.replace(/[<>]/g,'').trim();}

function validFile(f,max,types){
 if(!f||f.size>max*1024*1024||!types.includes(f.type)) return false;
 return true;
}

document.getElementById('oimi-form').addEventListener('submit',async e=>{
e.preventDefault();
if(document.getElementById('website').value!=="")return;
if(Date.now()-loadTime<4000){alert("يرجى تعبئة النموذج بشكل صحيح");return;}
if(btn.dataset.locked==="1")return;
btn.dataset.locked="1";btn.disabled=true;

const cv=document.getElementById('cv_file').files[0];
const rec=document.getElementById('receipt_file').files[0];
if(!validFile(cv,5,["application/pdf","image/jpeg","image/png"])||!validFile(rec,5,["image/jpeg","image/png"])){
alert("الملفات غير صالحة");btn.disabled=false;btn.dataset.locked="0";return;
}

const toB=f=>new Promise(r=>{const fr=new FileReader();fr.onload=()=>r(fr.result.split(',')[1]);fr.readAsDataURL(f);});

const payload={
"الاسم العربي":clean(u_name_ar.value),
"الاسم الانجليزي":clean(u_name_en.value),
"التخصص المهني":clean(u_spec.value),
"بلد الإقامة":u_country.value,
"رقم الهاتف":u_phone.value,
"رقم الواتس":u_whatsapp.value,
"البريد الإلكتروني":u_email.value.toLowerCase(),
"ملاحظات":clean(u_notes.value),
"كيف سمعت عننا":u_source.value,
"cv_data":await toB(cv),
"receipt_data":await toB(rec)
};

const res=await fetch(scriptURL,{method:"POST",body:JSON.stringify(payload)});
const j=await res.json();
alert("تم الاستلام بنجاح ✅\nرقمك: "+j.uniqueId);
location.reload();
});
</script>
</body>
</html>
